<!doctype html>
<html lang="es">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<title>Sophie - Checkout</title>
		<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Playfair+Display:wght@400;600&display=swap" rel="stylesheet">
		<link rel="stylesheet" href="styles.css" />
		<style>
			.checkout-hero { background: linear-gradient(135deg, rgba(255,107,157,0.12), rgba(217,70,166,0.08)); border-bottom: 1px solid rgba(0,0,0,0.04); }
			.checkout-hero .hero-title { margin-bottom: 6px; }
			.checkout-badges { display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }
			.checkout-pill { padding:6px 12px; border-radius:999px; font-size:0.9rem; border:1px solid rgba(0,0,0,0.08); background:rgba(255,255,255,0.65); color:#6b2840; }
			.checkout-pill.solid { background:#6b2840; color:#fff; border-color:#6b2840; }
			.checkout-pill.outline { background:transparent; }
			.checkout-section { padding:24px 16px 48px; }
			.checkout-grid { display:grid; grid-template-columns:1.15fr 0.85fr; gap:12px; align-items:start; max-width:1100px; margin:0 auto; }
			.checkout-card { padding:20px; border-radius:14px; background:#fff; box-shadow:0 10px 30px rgba(0,0,0,0.06); border:1px solid rgba(0,0,0,0.04); }
			.checkout-card h2 { margin-top:0; margin-bottom:10px; }
			.checkout-form { display:grid; grid-template-columns:1fr 1fr; gap:12px; }
			.checkout-form label { font-weight:600; font-size:0.95rem; color:#4a4a4a; display:block; margin-bottom:4px; }
			.checkout-form input, .checkout-form textarea, .checkout-form select { width:100%; padding:10px 12px; border:1px solid #e6e6e6; border-radius:10px; font-size:0.98rem; transition:border-color 0.2s, box-shadow 0.2s; background:#fff; }
			.checkout-form input:focus, .checkout-form textarea:focus, .checkout-form select:focus { outline:none; border-color:#d946a6; box-shadow:0 0 0 3px rgba(217,70,166,0.15); }
			.checkout-radio-group { grid-column:1/3; display:flex; flex-direction:column; gap:10px; padding:16px; border:1px solid #e0e0e0; border-radius:10px; background:rgba(0,0,0,0.02); }
			.checkout-radio-group strong { font-size:0.95rem; margin-bottom:4px; display:block; color:#333; }
			.checkout-radio { display:flex; align-items:center; gap:10px; cursor:pointer; }
			.checkout-radio input[type="radio"] { width:auto; margin:0; cursor:pointer; }
			.payment-note { display:flex; align-items:center; gap:6px; font-size:0.82rem; color:#7a7a7a; margin-left:28px; padding:6px 10px; background:linear-gradient(135deg, rgba(217,70,166,0.08), rgba(255,107,157,0.05)); border-left:3px solid #d946a6; border-radius:4px; }
			.payment-note::before { content:"⏱"; font-size:0.9rem; }
			#payment-card-section { transition:all 0.3s ease; }
			#payment-card-section h3 { font-size:1.05rem; color:#6b2840; font-weight:600; }
			#payment-card-section input { background:linear-gradient(135deg, rgba(255,255,255,0.95), rgba(217,70,166,0.02)) !important; transition:all 0.2s ease !important; }
			#payment-card-section input:focus { background:linear-gradient(135deg, #fff, rgba(217,70,166,0.05)) !important; border-color:#d946a6 !important; box-shadow:0 0 0 3px rgba(217,70,166,0.2) !important; }
			.checkout-summary { padding:0; margin-top:12px; border-top:1px solid #eee; }
			.checkout-summary .amounts { display:flex; flex-direction:column; gap:8px; padding-top:12px; }
			.checkout-summary .amounts div { display:flex; justify-content:space-between; align-items:center; }
			.checkout-summary .amounts div strong { font-size:1.05rem; }
			.checkout-actions { margin-top:12px; display:flex; flex-direction:column; gap:8px; }
			.checkout-note { margin-top:8px; font-size:0.95rem; color:#6b6b6b; }
			.checkout-divider { height:1px; background:linear-gradient(90deg, transparent, rgba(0,0,0,0.08), transparent); margin:14px 0; }
		</style>
	</head>
	<body>
		<header class="site-header">
			<div class="container header-inner">
				<button id="hamburger" class="hamburger" aria-label="Abrir menu">☰</button>
				<a href="index.html" class="logo" style="text-decoration:none;cursor:pointer;display:flex;align-items:center;gap:10px">
					<svg width="32" height="32" viewBox="0 0 32 32" style="flex-shrink:0;filter:drop-shadow(0 2px 4px rgba(0,0,0,0.1))">
						<defs>
							<linearGradient id="giftGradient" x1="0%" y1="0%" x2="100%" y2="100%">
								<stop offset="0%" style="stop-color:#ff6b9d;stop-opacity:1" />
								<stop offset="100%" style="stop-color:#d946a6;stop-opacity:1" />
							</linearGradient>
							<linearGradient id="ribbonGradient" x1="0%" y1="0%" x2="0%" y2="100%">
								<stop offset="0%" style="stop-color:#ffd700;stop-opacity:1" />
								<stop offset="100%" style="stop-color:#ffed4e;stop-opacity:1" />
							</linearGradient>
						</defs>
						<rect x="4" y="10" width="24" height="16" rx="2" fill="url(#giftGradient)" />
						<path d="M 4 10 Q 16 4 28 10" fill="#ff8ab3" />
						<rect x="14" y="4" width="4" height="22" fill="url(#ribbonGradient)" />
						<rect x="4" y="14" width="24" height="3" fill="url(#ribbonGradient)" />
						<circle cx="16" cy="8" r="3" fill="#ffd700" />
						<ellipse cx="8" cy="14" rx="2" ry="3" fill="rgba(255,255,255,0.4)" />
					</svg>
					<span style="font-size:1.3rem;font-weight:700;color:white">Sophie</span>
				</a>
				<button id="account-btn" class="account" type="button" aria-label="Abrir cuenta">👤 Iniciar sesión</button>
				<div id="account-menu" class="account-menu hidden" aria-hidden="true">
					<a href="profile.html" class="menu-item">👤 Ver Perfil</a>
					<button id="logout-btn" class="menu-item logout" type="button">🚪 Cerrar Sesión</button>
				</div>
				<div class="cart" id="open-cart" role="button">🛍️ <span id="cart-count">0</span></div>
			</div>
		</header>

		<div id="nav-overlay" class="nav-overlay" aria-hidden="true"></div>
		<!-- Modal para agradecimiento y factura -->
		<div id="order-modal" class="modal" aria-hidden="true" style="position:fixed;z-index:9999;top:0;left:0;width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.25)">
			<div id="order-modal-body" style="background:#fff;padding:32px 24px;border-radius:16px;max-width:420px;width:95vw;box-shadow:0 8px 32px rgba(0,0,0,0.18);position:relative"></div>
		</div>
		<aside id="nav-drawer" class="nav-drawer" aria-hidden="true">
			<div class="nav-drawer-inner">
				<button id="close-nav" class="close">✕</button>
				<nav class="nav-drawer-list">
					<a class="btn" href="index.html">Inicio</a>
					<button id="nav-products-toggle" class="btn nav-item">Productos ▾</button>
					<ul id="nav-products-submenu" class="nav-submenu" aria-hidden="true">
						<li><a class="btn" href="products.html?cat=all">Todos los productos</a></li>
						<li><a class="btn" href="products.html?cat=peluches">Peluches</a></li>
						<li><a class="btn" href="products.html?cat=tazas">Tazas</a></li>
						<li><a class="btn" href="products.html?cat=vasos">Vasos</a></li>
						<li><a class="btn" href="products.html?cat=mochilas">Mochilas</a></li>
						<li><a class="btn" href="products.html?cat=papeleria">Papelería</a></li>
						<li><a class="btn" href="products.html?cat=decoracion">Decoración</a></li>
						<li><a class="btn" href="products.html?cat=botellas">Botellas</a></li>
						<li><a class="btn" href="products.html?cat=belleza">Belleza</a></li>
						<li><a class="btn" href="products.html?cat=bloques">Bloques</a></li>
					</ul>
					<a class="btn" id="drawer-account" href="user-login.html" style="border-top:1px solid rgba(230,200,215,0.4);padding-top:12px;color:#6b2840;font-weight:700">👤 Iniciar sesión</a>
				</nav>
			</div>
		</aside>

		<main>
			<section class="hero checkout-hero">
				<div class="container hero-inner">
					<h1 class="hero-title">Procesar pedido</h1>
					<p class="hero-sub">Datos de envío, pago y resumen de tu compra.</p>
				</div>
			</section>

			<section class="container checkout-section">
				<div class="checkout-grid">
					<section class="checkout-card">
						<h2>Detalles de facturación y envío</h2>
						<form id="checkout-form" class="checkout-form">
							<div>
								<label>Nombre</label>
								<input name="firstName" placeholder="Nombre" required />
							</div>
							<div>
								<label>Apellidos</label>
								<input name="lastName" placeholder="Apellidos" required />
							</div>
							<div>
								<label>Correo</label>
								<input name="email" type="email" placeholder="correo@ejemplo.com" required />
							</div>
							<div>
								<label>Teléfono</label>
								<input name="phone" type="tel" placeholder="8888-8888" required />
							</div>
							
							<div id="shipping-fields" style="grid-column:1/-1;display:grid;gap:12px;grid-template-columns:1fr 1fr">
								<div>
									<label>Provincia</label>
									<select id="provincia" name="provincia" required>
										<option value="" disabled selected>Selecciona provincia</option>
									</select>
								</div>
								<div>
									<label>Cantón</label>
									<select id="canton" name="canton" required>
										<option value="" disabled selected>Selecciona cantón</option>
									</select>
								</div>
								<div>
									<label>Distrito</label>
									<input id="distrito" name="distrito" placeholder="Distrito" required />
								</div>
								<div>
									<label>Dirección exacta</label>
									<input name="address" placeholder="Casa, referencias, código postal" required />
								</div>
								<div style="grid-column:1/-1">
									<label>Notas de entrega (opcional)</label>
									<textarea name="notes" placeholder="Indicaciones especiales para la entrega" rows="3" style="width:100%;resize:vertical;font-family:inherit;font-size:inherit;padding:10px;border:1px solid #ddd;border-radius:8px;"></textarea>
								</div>
							</div>

							<div class="checkout-radio-group">
								<strong>Método de envío</strong>
								<label class="checkout-radio"><input type="radio" name="shipping" value="correos" checked /> Correos de Costa Rica</label>
							<label class="checkout-radio"><input type="radio" name="shipping" value="pickup" /> Retiro en tienda física (gratis)</label>
								
								<!-- Selector de tienda para retiro -->
								<div id="store-selector-container" style="display:none;margin-left:20px;margin-top:10px;padding:15px;background:#f3e5f5;border-radius:10px;border-left:4px solid #d946a6">
									<label for="pickup-store" style="display:block;font-weight:600;color:#5a2032;margin-bottom:8px">📍 Selecciona la tienda de retiro:</label>
									<select id="pickup-store" style="width:100%;padding:12px 14px;border:2px solid #e3cfe0;border-radius:10px;font-family:Montserrat,sans-serif;font-size:0.95rem;cursor:pointer">
										<option value="">-- Selecciona una tienda --</option>
										<option value="tienda1">Sophie Store</option>
										<option value="tienda2">Sophie Mall</option>
										<option value="tienda3">Sophie's Ticados</option>
									</select>
								</div>
								
								<strong>Método de pago</strong>
								<div>
									<label class="checkout-radio"><input type="radio" name="payment" value="transferencia" checked /> Transferencia </label>
								<span class="payment-note">Validamos el depósito en hasta 24 horas hábiles</span>
							</div>
							<div>
								<label class="checkout-radio"><input type="radio" name="payment" value="sinpe" /> SINPE Móvil</label>
								<span class="payment-note">Validamos el pago en hasta 24 horas hábiles</span>
								</div>
								<label class="checkout-radio"><input type="radio" name="payment" value="tarjeta" /> Tarjeta de crédito/débito</label>
							</div>

							<button type="submit" class="add" style="grid-column:1/3">Realizar pedido</button>
						</form>
					</section>

					<section class="checkout-card">
						<h2>Tu pedido</h2>
						<div id="checkout-items" class="cart-items" style="max-height:340px;overflow:auto"></div>
						<div id="checkout-empty" style="display:none;padding:12px 0;color:#666">Tu carrito está vacío.</div>
						<div class="checkout-summary">
							<div class="amounts">
								<div><span>Subtotal</span><strong id="checkout-subtotal">₡0.00</strong></div>
								<div><span>Envío</span><strong id="checkout-shipping">₡0.00</strong></div>
								<div class="checkout-divider"></div>
								<div><strong>Total</strong><strong id="checkout-total">₡0.00</strong></div>
							</div>
							<div class="checkout-note">Validamos pagos y coordinamos entrega en menos de 24 horas hábiles.</div>
						</div>

						<div id="payment-card-section" style="display:none;margin-top:16px;padding-top:16px;border-top:2px solid rgba(217,70,166,0.2)">
							<h3 style="margin:0 0 14px 0;font-size:1.05rem;color:#6b2840">💳 Datos de la tarjeta</h3>
							<div id="payment-card-fields" style="display:grid;gap:12px">
								<div>
									<label style="font-weight:600;font-size:0.95rem;color:#4a4a4a;display:block;margin-bottom:4px">Número de tarjeta</label>
									<input name="card_number" placeholder="1234 5678 9012 3456" maxlength="19" style="width:100%;padding:10px 12px;border:1px solid #e6e6e6;border-radius:10px;font-size:0.98rem;background:linear-gradient(135deg, rgba(255,255,255,0.95), rgba(217,70,166,0.02))" />
								</div>
								<div>
									<label style="font-weight:600;font-size:0.95rem;color:#4a4a4a;display:block;margin-bottom:4px">Nombre del titular</label>
									<input name="card_holder" placeholder="Nombre como aparece en la tarjeta" style="width:100%;padding:10px 12px;border:1px solid #e6e6e6;border-radius:10px;font-size:0.98rem;background:linear-gradient(135deg, rgba(255,255,255,0.95), rgba(217,70,166,0.02))" />
								</div>
								<div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
									<div>
										<label style="font-weight:600;font-size:0.95rem;color:#4a4a4a;display:block;margin-bottom:4px">Vencimiento (MM/YY)</label>
										<input name="card_expiry" placeholder="12/25" maxlength="5" style="width:100%;padding:10px 12px;border:1px solid #e6e6e6;border-radius:10px;font-size:0.98rem;background:linear-gradient(135deg, rgba(255,255,255,0.95), rgba(217,70,166,0.02))" />
									</div>
									<div>
										<label style="font-weight:600;font-size:0.95rem;color:#4a4a4a;display:block;margin-bottom:4px">CVV</label>
										<input name="card_cvv" placeholder="123" maxlength="3" type="password" style="width:100%;padding:10px 12px;border:1px solid #e6e6e6;border-radius:10px;font-size:0.98rem;background:linear-gradient(135deg, rgba(255,255,255,0.95), rgba(217,70,166,0.02))" />
									</div>
								</div>
								<p style="font-size:0.82rem;color:#999;margin:10px 0 0 0;padding:10px;background:rgba(217,70,166,0.08);border-radius:8px;border-left:3px solid #d946a6">🔒 Tus datos de tarjeta son seguros y encriptados</p>
							</div>
						</div>
					</section>
				</div>
			</section>
		</main>

		<div id="cart-overlay" class="cart-overlay" aria-hidden="true"></div>
		<aside id="cart-drawer" class="cart-drawer" aria-hidden="true">
			<div class="cart-drawer-header">
				<h3>Tu carrito</h3>
				<button id="close-cart" class="close">✕</button>
			</div>
			<div id="cart-items" class="cart-items"></div>
			<div class="cart-summary">
				<div class="amounts">
					<div><strong>Total</strong><strong id="cart-total">₡0</strong></div>
				</div>
				<div class="cart-actions">
					<button id="clear-cart" class="btn">Vaciar carrito</button>
					<button id="checkout" class="add">Pagar</button>
				</div>
			</div>
		</aside>

		<div id="product-modal" class="modal" aria-hidden="true">
			<div class="modal-content">
				<button id="close-modal" class="close">✕</button>
				<div id="modal-body"></div>
			</div>
		</div>

		<div id="order-modal" class="modal" aria-hidden="true">
			<div class="modal-content" style="text-align:center;padding:40px">
				<button id="close-order-modal" class="close">✕</button>
				<div id="order-modal-body"></div>
			</div>
		</div>

		<script src="script.js"></script>
		<script>
			(function(){
				const itemsNode = document.getElementById('checkout-items');
				const emptyNode = document.getElementById('checkout-empty');
				const subtotalNode = document.getElementById('checkout-subtotal');
				const shippingNode = document.getElementById('checkout-shipping');
				const totalNode = document.getElementById('checkout-total');
				const form = document.getElementById('checkout-form');
				const provinciaSel = document.getElementById('provincia');
				const cantonSel = document.getElementById('canton');
				const distritoInput = document.getElementById('distrito');
				const firstNameInput = form ? form.querySelector('input[name="firstName"]') : null;
				const lastNameInput = form ? form.querySelector('input[name="lastName"]') : null;
				const emailInput = form ? form.querySelector('input[name="email"]') : null;
				const phoneInput = form ? form.querySelector('input[name="phone"]') : null;
				const addressInput = form ? form.querySelector('input[name="address"]') : null;
			const notesInput = form ? form.querySelector('textarea[name="notes"]') : null;

				// Tarifas de Correos de Costa Rica por zona
				const shippingRatesByZone = {
					'GAM': 3500,           // Gran Área Metropolitana
					'Pacifico': 5000,      // Costa Pacífica
					'Atlantico': 5500      // Costa Atlántica y zonas alejadas
				};

				// Clasificación de provincias por zona
				const provinceZones = {
					'San José': 'GAM',
					'Heredia': 'GAM',
					'Alajuela': 'GAM',
					'Cartago': 'GAM',
					'Guanacaste': 'Pacifico',
					'Puntarenas': 'Pacifico',
					'Limón': 'Atlantico'
				};

				// Dataset completo (provincias -> cantones -> distritos) para Costa Rica
				const crLocations = {
					"San José": {
						"San José": ["Carmen","Merced","Hospital","Catedral","Zapote","San Francisco de Dos Ríos","Uruca","Mata Redonda","Pavas","Hatillo","San Sebastián"],
						"Escazú": ["Escazú","San Antonio","San Rafael"],
						"Desamparados": ["Desamparados","San Miguel","San Juan de Dios","San Rafael Arriba","San Antonio","Frailes","Patarrá","San Cristóbal","Rosario","Damas","San Rafael Abajo","Gravilias","Los Guido"],
						"Puriscal": ["Santiago","Mercedes Sur","Barbacoas","Grifo Alto","San Rafael","Candelarita","Desamparaditos","San Antonio","Chires"] ,
						"Tarrazú": ["San Marcos","San Lorenzo","San Carlos"],
						"Aserrí": ["Aserrí","Tarbaca","Vuelta de Jorco","San Gabriel","Legua","Monterrey","Salitrillos"],
						"Mora": ["Colón","Guayabo","Tabarcia","Piedras Negras","Picagres","Jaris","Quitirrisí"],
						"Goicoechea": ["Guadalupe","San Francisco","Calle Blancos","Mata de Plátano","Ipís","Rancho Redondo","Purral"],
						"Santa Ana": ["Santa Ana","Salitral","Pozos","Uruca","Piedades","Brasil"],
						"Alajuelita": ["Alajuelita","San Josecito","San Antonio","Concepción","San Felipe"],
						"Vázquez de Coronado": ["San Isidro","San Rafael","Dulce Nombre de Jesús","Patalillo","Cascajal"],
						"Acosta": ["San Ignacio","Guaitil","Palmichal","Cangrejal","Sabanillas"],
						"Tibás": ["San Juan","Cinco Esquinas","Anselmo Llorente","León XIII","Colima"],
						"Moravia": ["San Vicente","San Jerónimo","La Trinidad"],
						"Montes de Oca": ["San Pedro","Sabanilla","Mercedes","San Rafael"],
						"Turrubares": ["San Pablo","San Pedro","San Juan de Mata","San Luis","Carara"],
						"Dota": ["Santa María","Jardín","Copey"],
						"Curridabat": ["Curridabat","Granadilla","Sánchez","Tirrases"],
						"Pérez Zeledón": ["San Isidro de El General","El General","Daniel Flores","Rivas","San Pedro","Platanares","Pejibaye","Cajón","Barú","Río Nuevo","Páramo"] ,
						"León Cortés": ["San Pablo","San Andrés","Llano Bonito","San Isidro","Santa Cruz","San Antonio"]
					},
					"Alajuela": {
						"Alajuela": ["Alajuela","San José","Carrizal","San Antonio","Guácima","San Isidro","Sabanilla","San Rafael","Río Segundo","Desamparados","Turrúcares","Tambor","Garita","Sarapiquí"],
						"San Ramón": ["San Ramón","Santiago","San Juan","Piedades Norte","Piedades Sur","San Rafael","San Isidro","Angeles","Alfaro","Volio","Concepción","Zapotal","San Isidro de Peñas Blancas"],
						"Grecia": ["Grecia","San Isidro","San José","San Roque","Tacares","Río Cuarto","Puente de Piedra","Bolívar"],
						"San Mateo": ["San Mateo","Desmonte","Jesús María","Labrador"],
						"Atenas": ["Atenas","Jesús","Mercedes","San Isidro","Concepción","San José","Santa Eulalia","Escobal"],
						"Naranjo": ["Naranjo","San Miguel","San José","Cirrí Sur","San Jerónimo","San Juan","El Rosario","Palmitos"],
						"Palmares": ["Palmares","Zaragoza","Buenos Aires","Santiago","Candelaria","Esquipulas","La Granja"],
						"Poás": ["San Pedro","San Juan","San Rafael","Carrillos","Sabana Redonda"],
						"Orotina": ["Orotina","Mastate","Hacienda Vieja","Coyolar","La Ceiba"],
						"San Carlos": ["Quesada","Florencia","Buenavista","Aguas Zarcas","Venecia","Pital","La Fortuna","La Tigra","Palmera","Venado","Cutris","Monterrey","Pocosol"],
						"Zarcero": ["Zarcero","Laguna","Tapezco","Guadalupe","Palmira","Zapote","Brisas"],
						"Sarchí": ["Sarchí Norte","Sarchí Sur","Toro Amarillo","San Pedro","Rodríguez"],
						"Upala": ["Upala","Aguas Claras","San José o Pizote","Bijagua","Delicias","Dos Ríos","Yolillal","Canalete"],
						"Los Chiles": ["Los Chiles","Caño Negro","El Amparo","San Jorge"],
						"Guatuso": ["San Rafael","Buenavista","Cote","Katira"],
						"Río Cuarto": ["Río Cuarto","Santa Rita","Santa Isabel"]
					},
					"Cartago": {
						"Cartago": ["Oriental","Occidental","Carmen","San Nicolás","Aguacaliente o San Francisco","Guadalupe o Arenilla","Corralillo","Tierra Blanca","Dulce Nombre","Llano Grande","Quebradilla"],
						"Paraíso": ["Paraíso","Santiago","Orosi","Cachí","Llanos de Santa Lucía"],
						"La Unión": ["Tres Ríos","San Diego","San Juan","San Rafael","Concepción","Dulce Nombre","San Ramón","Río Azul"],
						"Jiménez": ["Juan Viñas","Tucurrique","Pejibaye"],
						"Turrialba": ["Turrialba","La Suiza","Peralta","Santa Teresita","Pavones","Tuis","Tayutic","Santa Rosa","Tres Equis","La Isabel","Chirripó"],
						"Alvarado": ["Pacayas","Cervantes","Capellades"],
						"Oreamuno": ["San Rafael","Cot","Potrero Cerrado","Cipreses","Santa Rosa"],
						"El Guarco": ["El Tejar","San Isidro","Tobosi","Patio de Agua"]
					},
					"Heredia": {
						"Heredia": ["Heredia","Mercedes","San Francisco","Ulloa","Varablanca"],
						"Barva": ["Barva","San Pedro","San Pablo","San Roque","Santa Lucía","San José de la Montaña"],
						"Santo Domingo": ["Santo Domingo","San Vicente","San Miguel","Paracito","Santo Tomás","Santa Rosa","Tures","Pará"],
						"Santa Bárbara": ["Santa Bárbara","San Pedro","San Juan","Jesús","Santo Domingo","Purabá"],
						"San Rafael": ["San Rafael","San Josecito","Santiago","Angeles","Concepción"],
						"San Isidro": ["San Isidro","San José","Concepción","San Francisco"],
						"Belén": ["San Antonio","La Ribera","La Asunción"],
						"Flores": ["San Joaquín","Barrantes","Llorente"],
						"San Pablo": ["San Pablo","Rincón de Sabanilla"],
						"Sarapiquí": ["Puerto Viejo","La Virgen","Horquetas","Llanuras del Gaspar","Cureña"],
						"San Joaquín": ["San Joaquín"]
					},
					"Guanacaste": {
						"Liberia": ["Liberia","Cañas Dulces","Mayorga","Nacascolo","Curubandé"],
						"Nicoya": ["Nicoya","Mansión","San Antonio","Quebrada Honda","Sámara","Nosara","Belén de Nosarita"],
						"Santa Cruz": ["Santa Cruz","Bolsón","Veintisiete de Abril","Tempate","Cartagena","Cuajiniquil","Diriá","Cabo Velas","Tamarindo"],
						"Bagaces": ["Bagaces","La Fortuna","Mogote","Río Naranjo"],
						"Carrillo": ["Filadelfia","Palmira","Sardinal","Belén"],
						"Cañas": ["Cañas","Palmira","San Miguel","Bebedero","Porozal"],
						"Abangares": ["Las Juntas","Sierra","San Juan","Colorado"],
						"Tilarán": ["Tilarán","Quebrada Grande","Tronadora","Santa Rosa","Líbano","Tierras Morenas","Arenal"],
						"Nandayure": ["Carmona","Santa Rita","Zapotal","San Pablo","Porvenir","Bejuco"],
						"La Cruz": ["La Cruz","Santa Cecilia","Garita","Santa Elena"],
						"Hojancha": ["Hojancha","Monte Romo","Puerto Carrillo","Huacas","Matambú"]
					},
					"Puntarenas": {
						"Puntarenas": ["Puntarenas","Pitahaya","Chomes","Lepanto","Paquera","Manzanillo","Guacimal","Barranca","Monte Verde","Isla del Coco","Cobano","Chacarita","Chira","Acapulco","Roble","Arancibia"],
						"Esparza": ["Espíritu Santo","San Juan Grande","Macacona","San Rafael","San Jerónimo","Caldera"],
						"Buenos Aires": ["Buenos Aires","Volcán","Potrero Grande","Boruca","Pilas","Colinas","Chánguena","Biolley","Brunka"],
						"Montes de Oro": ["Miramar","La Unión","San Isidro"],
						"Osa": ["Puerto Cortés","Palmar","Sierpe","Bahía Ballena","Piedras Blancas","Bahía Drake"],
						"Quepos": ["Quepos","Savegre","Naranjito"],
						"Golfito": ["Golfito","Puerto Jiménez","Guaycará","Pavón"],
						"Coto Brus": ["San Vito","Sabalito","Agua Buena","Limoncito","Pittier","Gutiérrez Brown"],
						"Parrita": ["Parrita"],
						"Corredores": ["Corredor","La Cuesta","Canoas","Laurel"],
						"Garabito": ["Jacó","Tárcoles"]
					},
					"Limón": {
						"Limón": ["Limón","Valle La Estrella","Río Blanco","Matama"],
						"Pococí": ["Guápiles","Jiménez","Rita","Roxana","Cariari","Colorado","La Colonia"],
						"Siquirres": ["Siquirres","Pacuarito","Florida","Germania","Cairo","Alegría"],
						"Talamanca": ["Bratsi","Sixaola","Cahuita","Telire"],
						"Matina": ["Matina","Batán","Carrandí"],
						"Guácimo": ["Guácimo","Mercedes","Pocora","Duacarí","Río Jiménez"]
					}
				};

				const safeFormat = window.formatPrice || function(n){ return '₡' + Number(n||0).toFixed(2); };
				const getCart = window.loadCart || function(){ return JSON.parse(localStorage.getItem('cart_v2')||'[]'); };
				function incrementSoldCounts(cartItems){
					if(!Array.isArray(cartItems)) return;
					const storedProducts = typeof window.loadProductsFromStorage === 'function' ? window.loadProductsFromStorage() : [];
					let changed = false;
					cartItems.forEach(item => {
						const id = item && item.id;
						const qty = Number(item && item.qty) || 0;
						if(!id || qty <= 0) return;
						const p = storedProducts.find(prod => prod.id === id);
						if(p){
							p.sold = (Number(p.sold) || 0) + qty;
							changed = true;
						}
					});
					if(changed && typeof window.saveProductsToStorage === 'function'){
						window.saveProductsToStorage(storedProducts);
						if(Array.isArray(window.products)) window.products = storedProducts;
					}
				}

				function currentShipping(){
					const checked = document.querySelector('input[name="shipping"]:checked');
					return checked ? checked.value : 'correos';
				}

				function getShippingCost(){
					const shippingMethod = currentShipping();
					if(shippingMethod === 'pickup') return 0;
					
					// Para Correos, calcular según la provincia seleccionada
					const selectedProvincia = provinciaSel.value;
					if(!selectedProvincia) return 0; // Sin costo hasta seleccionar provincia
					
					const zone = provinceZones[selectedProvincia] || 'GAM';
					return shippingRatesByZone[zone] || 3500;
				}

				function getShippingLabel(){
					const shippingMethod = currentShipping();
					if(shippingMethod === 'pickup') return 'Gratis';
					
					const selectedProvincia = provinciaSel.value;
					if(!selectedProvincia) return 'Seleccione provincia';
					
					const zone = provinceZones[selectedProvincia] || 'GAM';
					const cost = shippingRatesByZone[zone] || 3500;
					const zoneName = zone === 'GAM' ? 'GAM' : zone === 'Pacifico' ? 'Zona Pacífico' : 'Zona Atlántico';
					return `${safeFormat(cost)} (${zoneName})`;
				}

				function render(){
					const cart = getCart();
					itemsNode.innerHTML = '';
					if(!Array.isArray(cart) || cart.length===0){
						itemsNode.style.display='none';
						emptyNode.style.display='block';
						subtotalNode.textContent = safeFormat(0);
						shippingNode.textContent = getShippingLabel();
						totalNode.textContent = safeFormat(0);
						return;
					}
					itemsNode.style.display='block';
					emptyNode.style.display='none';
					let subtotal = 0;
					cart.forEach(item=>{
						const row = document.createElement('div');
						row.className = 'cart-item';
						const line = (item.price||0) * (item.qty||0);
						subtotal += line;
						row.innerHTML = `
							<img src="${item.img}" alt="${item.title}" />
							<div style="flex:1">
								<div style="display:flex;justify-content:space-between;align-items:center">
									<strong>${item.title}</strong>
									<span>x${item.qty||1}</span>
								</div>
								<div style="display:flex;justify-content:space-between;align-items:center;margin-top:6px">
									<div class="item-price">${safeFormat(item.price||0)}</div>
									<div class="item-price">${safeFormat(line)}</div>
								</div>
							</div>`;
						itemsNode.appendChild(row);
					});
					const ship = getShippingCost();
					subtotalNode.textContent = safeFormat(subtotal);
					shippingNode.textContent = getShippingLabel();
					totalNode.textContent = safeFormat(subtotal + ship);
				}

				// Dependientes provincia -> canton -> distrito
				function populateProvincias(){
					if(!provinciaSel) return;
					Object.keys(crLocations).forEach(p=>{
						const opt = document.createElement('option');
						opt.value = p;
						opt.textContent = p;
						provinciaSel.appendChild(opt);
					});
				}

				function populateCantones(prov){
					if(!cantonSel) return;
					cantonSel.innerHTML = '<option value="" disabled selected>Selecciona cantón</option>';
					if(distritoInput) distritoInput.value = '';
					if(!crLocations[prov]) return;
					Object.keys(crLocations[prov]).forEach(c=>{
						const opt = document.createElement('option');
						opt.value = c;
						opt.textContent = c;
						cantonSel.appendChild(opt);
					});
				}

				function loadAccounts(){
					try{ return JSON.parse(localStorage.getItem('user_accounts')||'[]'); }
					catch(e){ return []; }
				}

				function saveAccounts(list){
					localStorage.setItem('user_accounts', JSON.stringify(list));
				}

				function loadUserSession(){
					try{ return JSON.parse(localStorage.getItem('user_session')||'null'); }
					catch(e){ return null; }
				}

				function prefillFromSession(){
					const session = loadUserSession();
					if(!session) return;
					if(firstNameInput || lastNameInput){
						const parts = (session.name || '').trim().split(' ');
						if(firstNameInput) firstNameInput.value = parts[0] || '';
						if(lastNameInput) lastNameInput.value = session.lastName || parts.slice(1).join(' ');
					}
					if(emailInput && session.email) emailInput.value = session.email;
					const ship = session.shipping || {};
					if(phoneInput && ship.phone) phoneInput.value = ship.phone;
					if(provinciaSel && ship.provincia){
						provinciaSel.value = ship.provincia;
						populateCantones(ship.provincia);
					}
					if(cantonSel && ship.canton){ cantonSel.value = ship.canton; }
					if(distritoInput && ship.distrito){ distritoInput.value = ship.distrito; }
				if(addressInput && ship.address){ addressInput.value = ship.address; }
				if(notesInput && ship.notes){ notesInput.value = ship.notes; }

					render();
				}

				function collectShippingFromForm(){
					return {
						phone: phoneInput ? phoneInput.value.trim() : '',
						provincia: provinciaSel ? provinciaSel.value : '',
						canton: cantonSel ? cantonSel.value : '',
						distrito: distritoInput ? distritoInput.value.trim() : '',
						zip: '',
					address: addressInput ? addressInput.value.trim() : '',
					notes: notesInput ? notesInput.value.trim() : ''
				};
			}

			function saveShippingToAccount(){
				const session = loadUserSession();
				if(!session || !session.email){
					alert('Inicia sesión para guardar tu dirección.');
						return;
					}
					const accounts = loadAccounts();
					const idx = accounts.findIndex(acc => (acc.email||'').toLowerCase() === (session.email||'').toLowerCase());
					if(idx === -1){
						alert('No se encontró tu cuenta local.');
						return;
					}
					const ship = collectShippingFromForm();
					accounts[idx].shipping = ship;
					const newFirst = firstNameInput ? firstNameInput.value.trim() : '';
					const newLast = lastNameInput ? lastNameInput.value.trim() : '';
					if(newFirst) accounts[idx].name = newFirst;
					if(newLast) accounts[idx].lastName = newLast;
					saveAccounts(accounts);
					// Actualizar sesión
					const newSession = { ...session, shipping: ship, name: accounts[idx].name, lastName: accounts[idx].lastName || '' };
					localStorage.setItem('user_session', JSON.stringify(newSession));
					alert('Dirección guardada para futuras compras.');
				}

				// Poblar provincias al cargar
				populateProvincias();
				prefillFromSession();
				
				// Renderizar carrito inicial
				render();

				// Botón para guardar dirección
				if(form){
					saveAddressBtn = document.createElement('button');
					saveAddressBtn.type = 'button';
					saveAddressBtn.textContent = 'Guardar dirección en mi cuenta';
					saveAddressBtn.className = 'btn';
					saveAddressBtn.style.margin = '8px 0 0 0';
					form.insertBefore(saveAddressBtn, form.querySelector('button[type="submit"]'));
					saveAddressBtn.addEventListener('click', saveShippingToAccount);
				}

				if(provinciaSel) provinciaSel.addEventListener('change',()=>{
					populateCantones(provinciaSel.value);
					render(); // Actualiza tarifa de envío según zona
				});
				if(cantonSel) cantonSel.addEventListener('change',()=>{
					render(); // Actualiza totales
				});
				if(distritoInput) distritoInput.addEventListener('input',()=>{
					render(); // Actualiza totales
				});

				const shippingRadios = document.querySelectorAll('input[name="shipping"]');
				const shippingFields = document.getElementById('shipping-fields');
				const storeSelector = document.getElementById('store-selector-container');
				const pickupStore = document.getElementById('pickup-store');
				
				function toggleShippingFields(){
					const isCorreos = document.querySelector('input[name="shipping"]:checked').value === 'correos';
					const isPickup = document.querySelector('input[name="shipping"]:checked').value === 'pickup';
					
					if(shippingFields){
						shippingFields.style.display = isCorreos ? 'grid' : 'none';
					}
					
					if(storeSelector){
						storeSelector.style.display = isPickup ? 'block' : 'none';
						if(isPickup && pickupStore) pickupStore.setAttribute('required', 'required');
						else if(pickupStore) pickupStore.removeAttribute('required');
					}
					
					// Actualizar atributo required para campos de envío
					const requiredFields = shippingFields ? shippingFields.querySelectorAll('input[required], select[required], textarea[required]') : [];
					requiredFields.forEach(field => {
						if(isCorreos) field.setAttribute('required', 'required');
						else field.removeAttribute('required');
					});
				}
				
				shippingRadios.forEach(r=> {
					r.addEventListener('change', ()=>{
						toggleShippingFields();
						render();
					});
				});
				
				toggleShippingFields();

				// Mostrar/ocultar campos de tarjeta según método de pago
				const paymentRadios = document.querySelectorAll('input[name="payment"]');
				const cardSection = document.getElementById('payment-card-section');
				
				function toggleCardFields(){
					const isTarjeta = document.querySelector('input[name="payment"]:checked').value === 'tarjeta';
					if(cardSection){
						cardSection.style.display = isTarjeta ? 'block' : 'none';
					}
					// Actualizar atributo required
					const cardInputs = cardSection ? cardSection.querySelectorAll('input') : [];
					cardInputs.forEach(input => {
						if(isTarjeta) input.setAttribute('required', 'required');
						else input.removeAttribute('required');
					});
				}
				
				paymentRadios.forEach(r=> {
					r.addEventListener('change', toggleCardFields);
				});

				function generateOrderNumber(){
					const date = new Date();
					const year = date.getFullYear();
					const month = String(date.getMonth() + 1).padStart(2, '0');
					const day = String(date.getDate()).padStart(2, '0');
					const randomNum = String(Math.floor(Math.random() * 100000)).padStart(5, '0');
					return `ORD-${year}${month}${day}-${randomNum}`;
				}

				if(form){
					form.addEventListener('submit',(e)=>{
						e.preventDefault();
						const paymentMethod = document.querySelector('input[name="payment"]:checked').value;
						const shippingMethod = document.querySelector('input[name="shipping"]:checked').value;
						const userEmail = document.querySelector('input[name="email"]').value;
						const requiresValidation = paymentMethod === 'sinpe' || paymentMethod === 'transferencia';
						const cartItems = getCart();
						incrementSoldCounts(cartItems);
						// Decrementar inventario de productos al comprar online
						(function decrementInventory(cartItems, shippingMethod, pickupStoreKey) {
							if (!Array.isArray(cartItems)) return;
							const storedProducts = typeof window.loadProductsFromStorage === 'function' ? window.loadProductsFromStorage() : [];
							let changed = false;
							cartItems.forEach(item => {
								const id = item && item.id;
								const qty = Number(item && item.qty) || 0;
								if (!id || qty <= 0) return;
								const p = storedProducts.find(prod => prod.id === id);
								if (p) {
									// Si el producto tiene variantes y se especifica variante
									if (p.variants && item.variant) {
										const opt = (p.variants.options || []).find(o => o.name === item.variant);
										if (opt && opt.inventory) {
											let left = qty;
											let keys;
											if (shippingMethod === 'pickup' && pickupStoreKey && opt.inventory[pickupStoreKey] !== undefined) {
												// Solo descontar de la tienda seleccionada
												keys = [pickupStoreKey];
											} else {
												// Decrementar de bodega primero, luego tiendas
												keys = ['bodega', 'tienda1', 'tienda2', 'tienda3'];
											}
											for (const k of keys) {
												if (opt.inventory[k] && left > 0) {
													const take = Math.min(opt.inventory[k], left);
													opt.inventory[k] -= take;
													left -= take;
												}
											}
											changed = true;
										}
									} else if (p.inventory) {
										let left = qty;
										let keys;
										if (shippingMethod === 'pickup' && pickupStoreKey && p.inventory[pickupStoreKey] !== undefined) {
											keys = [pickupStoreKey];
										} else {
											keys = ['bodega', 'tienda1', 'tienda2', 'tienda3'];
										}
										for (const k of keys) {
											if (p.inventory[k] && left > 0) {
												const take = Math.min(p.inventory[k], left);
												p.inventory[k] -= take;
												left -= take;
											}
										}
										changed = true;
									}
								}
							});
							if (changed && typeof window.saveProductsToStorage === 'function') {
								window.saveProductsToStorage(storedProducts);
								if (Array.isArray(window.products)) window.products = storedProducts;
							}
						})(cartItems, shippingMethod, (shippingMethod === 'pickup' ? document.getElementById('pickup-store').value : null));
						
						// Capturar información de retiro en tienda si aplica
						let pickupStoreInfo = '';
						let pickupStoreKey = '';
						if(shippingMethod === 'pickup'){
							const pickupStore = document.getElementById('pickup-store').value;
							const storeNames = {
								'tienda1': 'Sophie Store',
								'tienda2': 'Sophie Mall',
								'tienda3': 'Sophie\'s Ticados'
							};
							pickupStoreInfo = storeNames[pickupStore] || 'Tienda no especificada';
							pickupStoreKey = pickupStore;
						}
						
						// Guardar la orden en invoiceHistory como venta de tienda virtual
						const orderNum = generateOrderNumber();
						const invoiceHistory = JSON.parse(localStorage.getItem('invoiceHistory') || '[]');
						
						const invoice = {
							id: orderNum,
							date: new Date().toISOString(),
							source: 'tienda_virtual',
							cashier: 'Tienda Virtual',
							store: 'tienda_virtual',
							paymentMethods: [{method: paymentMethod, amount: cartItems.reduce((sum, item) => sum + (item.price * item.qty), 0)}],
							items: cartItems,
							subtotal: cartItems.reduce((sum, item) => sum + (item.price * item.qty), 0),
							discount: 0,
							shippingMethod: shippingMethod,
							pickupStore: pickupStoreKey,
							pickupStoreInfo: pickupStoreInfo,
							customerEmail: userEmail,
							customerName: userEmail.split('@')[0],
							status: 'pendiente'
						};
						
						invoiceHistory.push(invoice);
						localStorage.setItem('invoiceHistory', JSON.stringify(invoiceHistory));
						console.log('✅ Venta de tienda virtual guardada:', invoice);
						
						// TAMBIÉN guardar en onlineOrders para el tab de Pedidos Online
						const onlineOrders = JSON.parse(localStorage.getItem('onlineOrders') || '[]');
						console.log('📦 Pedidos existentes antes de agregar:', onlineOrders);
						
						const onlineOrder = {
							id: orderNum,
							date: new Date().toISOString(),
							customerEmail: userEmail,
							paymentMethod: paymentMethod,
							total: cartItems.reduce((sum, item) => sum + (item.price * item.qty), 0),
							status: paymentMethod === 'tarjeta' ? 'confirmado' : 'pendiente',
							items: cartItems,
							shippingMethod: shippingMethod,
							confirmedDate: paymentMethod === 'tarjeta' ? new Date().toISOString() : null,
							dispatchedDate: null
						};
						onlineOrders.push(onlineOrder);
						localStorage.setItem('onlineOrders', JSON.stringify(onlineOrders));
						console.log('✅ Pedido online guardado en onlineOrders:', onlineOrder);
						console.log('✅ Total de pedidos ahora:', onlineOrders.length);
						
						if(paymentMethod === 'tarjeta'){
							// Modal de agradecimiento y factura para tarjeta
							let facturaHTML = `
								<h2 style="color:#6b2840;margin:0 0 20px 0">¡Gracias por tu compra!</h2>
								<p style="font-size:1.1rem;color:#666;margin:0 0 20px 0">Tu pago con tarjeta fue exitoso.</p>
								<div style="background:linear-gradient(135deg, rgba(217,70,166,0.1), rgba(255,107,157,0.1));padding:20px;border-radius:12px;margin:0 0 20px 0">
									<p style="font-size:1.1rem;color:#d946a6;margin:0 0 10px 0;font-family:monospace;letter-spacing:2px"><strong>Factura #${orderNum}</strong></p>
									<p style="margin:0;color:#666"><strong>Fecha:</strong> ${new Date().toLocaleString('es-CR')}</p>
									<p style="margin:0;color:#666"><strong>Cliente:</strong> ${userEmail}</p>
								</div>
								<div style="margin-bottom:16px">
									<table style='width:100%;font-size:0.98rem;border-collapse:collapse'>
										<thead><tr style='background:#f3e5f5'><th style='text-align:left;padding:6px'>Producto</th><th style='text-align:right;padding:6px'>Cantidad</th><th style='text-align:right;padding:6px'>Precio</th></tr></thead>
										<tbody>
											${cartItems.map(item => `<tr><td style='padding:6px'>${item.title}${item.variant ? ' ('+item.variant+')' : ''}</td><td style='text-align:right;padding:6px'>${item.qty}</td><td style='text-align:right;padding:6px'>₡${(item.price*item.qty).toFixed(2)}</td></tr>`).join('')}
										</tbody>
									</table>
								</div>
								<div style="text-align:right;margin-bottom:10px">
									<strong>Subtotal:</strong> ₡${invoice.subtotal.toFixed(2)}<br/>
									<strong>Envío:</strong> ${shippingMethod==='pickup' ? 'Gratis' : document.getElementById('checkout-shipping').textContent}<br/>
									<strong>Total:</strong> ₡${(invoice.subtotal + (shippingMethod==='pickup'?0:getShippingCost())).toFixed(2)}
								</div>
								<button class="add order-confirm-btn" style="margin-top:20px">Cerrar</button>
							`;
							let modal = document.getElementById('order-modal');
							let modalBody = document.getElementById('order-modal-body');
							modalBody.innerHTML = facturaHTML;
							modal.setAttribute('aria-hidden', 'false');
							const confirmBtn = modalBody.querySelector('.order-confirm-btn');
							confirmBtn.addEventListener('click', ()=>{
								modal.setAttribute('aria-hidden', 'true');
								localStorage.removeItem('cart_v2');
								if(typeof window.renderCartCount === 'function') window.renderCartCount([]);
								window.location.href = 'index.html';
							});
						} else if(requiresValidation){
							const paymentText = paymentMethod === 'sinpe' ? 'SINPE Móvil' : 'Transferencia Bancaria';
							// ...existing code...
							let orderDetailsHTML = `
								<h2 style="color:#6b2840;margin:0 0 20px 0">¡Pedido Confirmado!</h2>
								<p style="font-size:1.1rem;color:#666;margin:0 0 30px 0">Tu número de orden es:</p>
								<div style="background:linear-gradient(135deg, rgba(217,70,166,0.1), rgba(255,107,157,0.1));padding:20px;border-radius:12px;margin:0 0 20px 0">
									<p style="font-size:2rem;font-weight:700;color:#d946a6;margin:0;font-family:monospace;letter-spacing:2px">${orderNum}</p>
								</div>
								<p style="color:#666;margin:0 0 15px 0"><strong>Método de pago:</strong> ${paymentText}</p>
								<p style="color:#666;margin:0 0 15px 0"><strong>Correo:</strong> ${userEmail}</p>`;
							if(pickupStoreInfo){
								orderDetailsHTML += `<p style="color:#666;margin:0 0 15px 0"><strong>Retiro en:</strong> ${pickupStoreInfo}</p>`;
							}
							orderDetailsHTML += `
								<p style="font-size:0.95rem;color:#999;margin:0 0 20px 0">Validaremos tu pago en hasta 24 horas hábiles</p>
								<p style="font-size:0.9rem;color:#999;margin:0">Hemos enviado estos detalles a tu correo (cuando esté configurado el servicio de email)</p>
								<button class="add order-confirm-btn" style="margin-top:20px">Entendido</button>
							`;
							orderModalBody.innerHTML = orderDetailsHTML;
							orderModal.setAttribute('aria-hidden', 'false');
							const confirmBtn = orderModalBody.querySelector('.order-confirm-btn');
							confirmBtn.addEventListener('click', ()=>{
								orderModal.setAttribute('aria-hidden', 'true');
								localStorage.removeItem('cart_v2');
								if(typeof window.renderCartCount === 'function') window.renderCartCount([]);
								window.location.href = 'index.html';
							});
						} else {
							const confirmMsg = pickupStoreInfo 
								? `Gracias por tu compra.\n\nRetiro en: ${pickupStoreInfo}\n\nProto te contactaremos para confirmar.`
								: 'Gracias por tu compra. Pronto te contactaremos para procesar el pago.';
							alert(confirmMsg);
							localStorage.removeItem('cart_v2');
							if(typeof window.renderCartCount === 'function') window.renderCartCount([]);
							render();
						}
					});
				}
			})();
		</script>
	</body>
</html>
