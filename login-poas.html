<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Iniciar Sesi√≥n - Po√°s POS</title>
    <link rel="stylesheet" href="styles.css" />
    <style>
      @font-face {
        font-family: 'Daily';
        src: url('./Typos Sophie/Daily.otf') format('opentype');
        font-weight: normal;
        font-style: normal;
      }
      .login-container {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        background: linear-gradient(135deg, #ffffff 0%, #e6fcff 100%);
        padding: 20px;
      }
      .login-box {
        background: white;
        padding: 40px;
        border-radius: 20px;
        box-shadow: 0 10px 40px rgba(9, 72, 151, 0.15);
        max-width: 400px;
        width: 100%;
      }
      .login-logo {
        text-align: center;
        margin-bottom: 30px;
      }
      .login-logo img {
        width: 220px;
        height: auto;
        object-fit: contain;
        margin-bottom: 16px;
        filter: drop-shadow(0 4px 12px rgba(9, 72, 151, 0.2));
      }
      .login-logo h1 {
        font-family: 'Daily', Playfair Display, serif;
        color: #094897;
        margin: 12px 0 8px;
        font-size: 2rem;
      }
      .login-logo p {
        color: #888;
        margin: 0;
        font-size: 0.95rem;
      }
      .login-logo .subtitle {
        font-size: 0.85rem;
        color: #B411AF;
        font-weight: 600;
        margin-top: 4px;
      }
      .form-group {
        margin-bottom: 20px;
      }
      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #094897;
        font-size: 0.95rem;
      }
      .form-group input {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        font-family: Montserrat, sans-serif;
        font-size: 1rem;
        transition: border-color 0.3s;
        box-sizing: border-box;
      }
      .form-group input:focus {
        outline: none;
        border-color: #094897;
        box-shadow: 0 0 0 3px rgba(9, 72, 151, 0.1);
      }
      .btn-login {
        width: 100%;
        padding: 14px;
        background: linear-gradient(135deg, #094897, #280498);
        color: white;
        border: none;
        border-radius: 10px;
        font-weight: 700;
        font-size: 1.05rem;
        cursor: pointer;
        transition: all 0.3s;
        margin-top: 10px;
      }
      .btn-login:hover {
        box-shadow: 0 6px 20px rgba(9, 72, 151, 0.4);
        transform: translateY(-2px);
      }
      .btn-login:active {
        transform: translateY(0);
      }
      .btn-back {
        display: block;
        text-align: center;
        margin-top: 20px;
        color: #094897;
        text-decoration: none;
        font-weight: 600;
      }
      .btn-back:hover {
        text-decoration: underline;
      }
      .error-message {
        background: rgba(255, 84, 3, 0.12);
        color: #FF5403;
        padding: 12px;
        border-radius: 8px;
        margin-bottom: 20px;
        display: none;
        font-size: 0.9rem;
        border: 1px solid rgba(255, 84, 3, 0.35);
      }
      .error-message.show {
        display: block;
      }
      .success-message {
        background: rgba(61, 173, 242, 0.12);
        color: #094897;
        padding: 12px;
        border-radius: 8px;
        margin-bottom: 20px;
        display: none;
        font-size: 0.9rem;
        border: 1px solid rgba(61, 173, 242, 0.4);
      }
      .success-message.show {
        display: block;
      }
      .link-button {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
        border: none;
        background: transparent;
        color: #094897;
        font-weight: 600;
        cursor: pointer;
        text-decoration: underline;
        padding: 0;
        margin-top: 10px;
      }
      .modal {
        position: fixed;
        inset: 0;
        display: none;
        align-items: center;
        justify-content: center;
        background: rgba(0,0,0,0.6);
        z-index: 9999;
        padding: 20px;
      }
      .modal.active {
        display: flex;
      }
      .modal-card {
        background: #fff;
        border-radius: 14px;
        padding: 24px;
        width: 100%;
        max-width: 420px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        position: relative;
      }
      .modal-close {
        position: absolute;
        top: 10px;
        right: 12px;
        border: none;
        background: transparent;
        font-size: 1.5rem;
        cursor: pointer;
        color: #777;
      }
      .modal-card h3 {
        margin-top: 0;
        color: #094897;
      }
      .poas-badge {
        display: inline-block;
        background: linear-gradient(135deg, #094897, #B411AF);
        color: white;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 700;
        margin-top: 12px;
      }
      .user-roles {
        background: #f5f5f5;
        padding: 12px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-size: 0.85rem;
        color: #666;
        border-left: 3px solid #094897;
      }
      .user-roles strong {
        color: #094897;
        display: block;
        margin-bottom: 6px;
      }
      .role-item {
        padding: 4px 0;
        display: flex;
        align-items: center;
        gap: 8px;
      }
    </style>
  </head>
  <body>
    <div class="login-container">
      <div class="login-box">
        <div class="login-logo">
          <img src="Logo%20Po%C3%A1s/Logos-Poas-color-1.png" alt="Logo Po√°s" />
          <p>Punto de Ventas</p>
          <div class="poas-badge">üè™ POS SYSTEM</div>
        </div>

        <div id="success-message" class="success-message">
          ‚úÖ Sesi√≥n iniciada. Redirigiendo...
        </div>

        <div id="error-message" class="error-message">
          Usuario o contrase√±a incorrectos
        </div>

        <form id="login-form">
          <div class="form-group">
            <label for="username">Usuario</label>
            <input type="text" id="username" name="username" placeholder="Ingresa tu usuario" required autocomplete="username">
          </div>

          <div class="form-group">
            <label for="password">Contrase√±a</label>
            <input type="password" id="password" name="password" placeholder="Ingresa tu contrase√±a" required autocomplete="current-password">
          </div>

          <button type="submit" class="btn-login">Iniciar Sesi√≥n</button>
        </form>

        <button type="button" class="link-button" id="open-change-password">¬øCambiar contrase√±a?</button>

        <div id="change-password-modal" class="modal" aria-hidden="true">
          <div class="modal-card">
            <button type="button" class="modal-close" id="close-change-password" aria-label="Cerrar">√ó</button>
            <h3>Cambiar contrase√±a</h3>
            <div id="change-password-success" class="success-message">Contrase√±a actualizada.</div>
            <div id="change-password-error" class="error-message">No se pudo actualizar la contrase√±a.</div>
            <form id="change-password-form">
              <div class="form-group">
                <label for="change-username">Usuario</label>
                <input type="text" id="change-username" required autocomplete="username">
              </div>
              <div class="form-group">
                <label for="change-current">Contrase√±a actual</label>
                <input type="password" id="change-current" required autocomplete="current-password">
              </div>
              <div class="form-group">
                <label for="change-new">Nueva contrase√±a</label>
                <input type="password" id="change-new" required autocomplete="new-password">
              </div>
              <div class="form-group">
                <label for="change-confirm">Confirmar nueva contrase√±a</label>
                <input type="password" id="change-confirm" required autocomplete="new-password">
              </div>
              <button type="submit" class="btn-login">Guardar</button>
            </form>
          </div>
        </div>

        <a href="index.html" class="btn-back">‚Üê Volver a la tienda</a>
      </div>
    </div>

    <script>
      // Credenciales de usuarios para Po√°s POS
      const VALID_USERS = {
        // Encargados
        'Darlyn': 'Poas2026',
        'Rebeca': 'Poas2026',
        'Elizabeth': 'Poas2026',
        // Administradores
        'Moni': 'Poas2026',
        'Hernan': 'Poas2026',
        'David': 'Poas2026',
        'Esteban': 'Poas2026',
        // Vendedores
        'PVPoas': 'Poas2026'
      };

      const PASSWORD_STORAGE_KEY = 'poas_passwords';
      const getStoredPasswords = () => {
        try {
          return JSON.parse(localStorage.getItem(PASSWORD_STORAGE_KEY) || '{}');
        } catch (err) {
          return {};
        }
      };
      const setStoredPasswords = (data) => {
        localStorage.setItem(PASSWORD_STORAGE_KEY, JSON.stringify(data));
      };

      const form = document.getElementById('login-form');
      const errorMessage = document.getElementById('error-message');
      const successMessage = document.getElementById('success-message');
      const usernameInput = document.getElementById('username');
      const passwordInput = document.getElementById('password');
      const openChangeBtn = document.getElementById('open-change-password');
      const changeModal = document.getElementById('change-password-modal');
      const closeChangeBtn = document.getElementById('close-change-password');
      const changeForm = document.getElementById('change-password-form');
      const changeUserInput = document.getElementById('change-username');
      const changeCurrentInput = document.getElementById('change-current');
      const changeNewInput = document.getElementById('change-new');
      const changeConfirmInput = document.getElementById('change-confirm');
      const changeError = document.getElementById('change-password-error');
      const changeSuccess = document.getElementById('change-password-success');

      // Verificar si ya hay sesi√≥n activa
      if (sessionStorage.getItem('poasLoggedIn') === 'true') {
        window.location.href = 'pos-poas.html';
      }

      form.addEventListener('submit', (e) => {
        e.preventDefault();
        
        const username = usernameInput.value.trim();
        const password = passwordInput.value;

        const storedPasswords = getStoredPasswords();
        const expectedPassword = storedPasswords[username] ?? VALID_USERS[username];

        if (expectedPassword && expectedPassword === password) {
          // Login exitoso
          errorMessage.classList.remove('show');
          successMessage.classList.add('show');
          
          sessionStorage.setItem('poasLoggedIn', 'true');
          sessionStorage.setItem('poasUsername', username);
          
          // Determinar tipo de usuario
          let userType = 'vendedor'; // por defecto
          if (['Darlyn', 'Rebeca', 'Elizabeth'].includes(username)) {
            userType = 'encargado';
          } else if (['Moni', 'Hernan', 'David', 'Esteban'].includes(username)) {
            userType = 'admin';
          }
          
          sessionStorage.setItem('poasUserType', userType);
          
          // Guardar hora de login
          sessionStorage.setItem('poasLoginTime', new Date().toISOString());
          
          // Redirigir despu√©s de 800ms
          setTimeout(() => {
            window.location.href = 'pos-poas.html';
          }, 800);
        } else {
          // Login fallido
          successMessage.classList.remove('show');
          errorMessage.classList.add('show');
          passwordInput.value = '';
          passwordInput.focus();
          
          // Ocultar mensaje despu√©s de 3 segundos
          setTimeout(() => {
            errorMessage.classList.remove('show');
          }, 3000);
        }
      });

      // Ocultar mensaje de error al escribir
      usernameInput.addEventListener('input', () => {
        errorMessage.classList.remove('show');
      });
      
      passwordInput.addEventListener('input', () => {
        errorMessage.classList.remove('show');
      });

      // Auto-focus al usuario
      usernameInput.focus();

      const openChangeModal = () => {
        if (!changeModal) return;
        changeModal.classList.add('active');
        changeModal.setAttribute('aria-hidden', 'false');
        if (changeUserInput) {
          changeUserInput.value = usernameInput.value.trim();
        }
        changeError.classList.remove('show');
        changeSuccess.classList.remove('show');
      };

      const closeChangeModal = () => {
        if (!changeModal) return;
        changeModal.classList.remove('active');
        changeModal.setAttribute('aria-hidden', 'true');
      };

      openChangeBtn?.addEventListener('click', openChangeModal);
      closeChangeBtn?.addEventListener('click', closeChangeModal);
      changeModal?.addEventListener('click', (e) => {
        if (e.target === changeModal) {
          closeChangeModal();
        }
      });

      changeForm?.addEventListener('submit', (e) => {
        e.preventDefault();
        changeError.classList.remove('show');
        changeSuccess.classList.remove('show');

        const username = changeUserInput.value.trim();
        const currentPassword = changeCurrentInput.value;
        const newPassword = changeNewInput.value;
        const confirmPassword = changeConfirmInput.value;

        if (!username || !currentPassword || !newPassword || !confirmPassword) {
          changeError.textContent = 'Completa todos los campos.';
          changeError.classList.add('show');
          return;
        }

        if (newPassword !== confirmPassword) {
          changeError.textContent = 'La nueva contrase√±a no coincide.';
          changeError.classList.add('show');
          return;
        }

        const storedPasswords = getStoredPasswords();
        const expectedPassword = storedPasswords[username] ?? VALID_USERS[username];

        if (!expectedPassword) {
          changeError.textContent = 'Usuario no encontrado.';
          changeError.classList.add('show');
          return;
        }

        if (expectedPassword !== currentPassword) {
          changeError.textContent = 'Contrase√±a actual incorrecta.';
          changeError.classList.add('show');
          return;
        }

        storedPasswords[username] = newPassword;
        setStoredPasswords(storedPasswords);
        changeSuccess.textContent = 'Contrase√±a actualizada.';
        changeSuccess.classList.add('show');
        changeCurrentInput.value = '';
        changeNewInput.value = '';
        changeConfirmInput.value = '';
        setTimeout(() => {
          closeChangeModal();
        }, 1200);
      });
    </script>
  </body>
</html>
